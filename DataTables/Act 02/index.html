<!DOCTYPE html>
<html lang="en">
<head>
    <title>Buttons + Responsive</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS + JQuery -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.0/css/bootstrap.min.css" integrity="sha384-SI27wrMjH3ZZ89r4o+fGIJtnzkAnFs3E4qz9DIYioCQ5l9Rd/7UAa8DHcaL8jkWt" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>

    <!-- DataTables -->
    <script type="text/javascript" src="https://cdn.datatables.net/v/dt/dt-1.10.20/datatables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.css"/>

    <!-- DataTables Select -->
    <script src="https://cdn.datatables.net/select/1.2.7/js/dataTables.select.min.js"></script>

    <!-- DataTables Buttons -->
    <script src="https://cdn.datatables.net/buttons/1.6.1/js/dataTables.buttons.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.6.1/js/buttons.bootstrap4.min.js"/>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.bootstrap4.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.6.1/css/buttons.bootstrap4.min.css"/>
    <script src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.flash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.print.min.js"></script>

    <!-- DataTables Responsive -->
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.dataTables.min.css"/>
    <script src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>

</head>
<body>
<div class="container-fluid">
    <h1 class="offset-md-1"> Persones </h1>
    <br/>
    <div class="row">
        <div class="col-6 col-4 col-lg-2 my-2 my-lg-0 px-0">
            <form class="bg-primary p-3 rounded-right text-white">
                <div class="custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input" id="checkBEdat">
                    <label class="custom-control-label" for="checkBEdat">Edat</label>
                </div>
                <div class="custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input" id="checkBExp">
                    <label class="custom-control-label" for="checkBExp">Experiencia</label>
                </div>
                <div class="custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input" id="checkBSexe">
                    <label class="custom-control-label" for="checkBSexe">Sexe</label>
                </div>
            </form>
        </div>
        <div class="col-md-10 offset-1 offset-lg-0">
            <div class="container-fluid">
                <div class="row mb-2 ">
                    <div class="col-10 col-sm-7" id="buttonsZone"></div>
                    <!--Dropdown-->
                    <div class="col-2 col-sm-5 d-flex flex-row-reverse">
                        <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownSexe" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Sexe
                        </button>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownSexe">
                            <a class="dropdown-item" id="dropT" href="#">Tothom</a>
                            <a class="dropdown-item" id="dropM" href="#">Home</a>
                            <a class="dropdown-item" id="dropF" href="#">Dona</a>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col text-center">
                        <table id="table" class="display nowrap table table-striped table-bordered" style="width:100%">
                            <thead>
                            <tr>
                                <th>Nom</th>
                                <th>Email</th>
                                <th>Edat</th>
                                <th>Experiencia</th>
                                <th>Sexe</th>
                            </tr>
                            </thead>
                        </table>
                    </div>
                </div>
                <div class="row">
                    <div class="col d-flex flex-row" id="exportButtons"></div>
                </div>
            </div>
        </div>
    </div>




</div>

<script>
    $(document).ready(function() {
        var dt = loadPersones();
        dt.buttons().container().appendTo('#exportButtons');

        loadButtons(dt);

        checkEdat(dt);
        checkExperiencia(dt);

        $('#dropT').click(function(){filterSexe(dt, null)});
        $('#dropM').click(function(){filterSexe(dt, "M")});
        $('#dropF').click(function(){filterSexe(dt, "F")});

        $('#checkBEdat').click(function(){hideColumn(dt, "2")});
        $('#checkBExp').click(function(){hideColumn(dt, "3")});
        $('#checkBSexe').click(function(){hideColumn(dt, "4")});
    });


    function loadPersones() {
        return $('#table').DataTable({
            dom: 'Brtp',
            ajax: {
                url: 'persones.php',
                dataSrc: '',
                type: "get",
            },
            columns: [
                {data: 'Nom'},
                {data: 'Email'},
                {data: 'Edat'},
                {data: 'Experiencia'},
                {data: 'Sexe'}],
            select: true,

            responsive: true,
            buttons: [
                {
                    extend: 'copy',
                    className: 'btn-primary',
                    text: '<i class="fas fa-copy"></i>',
                    init: removeSecondaryButtons
                },
                {
                    extend: 'csv',
                    className: 'btn-primary',
                    text: '<i class="fas fa-file-csv"></i>',
                    init: removeSecondaryButtons
                },
                {
                    extend: 'excel',
                    className: 'btn-primary',
                    text: '<i class="fas fa-file-excel"></i>',
                    init: removeSecondaryButtons
                },
                {
                    extend: 'pdf',
                    className: 'btn-primary',
                    text: '<i class="fa fa-file-pdf"></i>',
                    init: removeSecondaryButtons
                },
                {
                    extend: 'print',
                    className: 'btn-primary',
                    text: '<i class="fas fa-print"></i>',
                    init: removeSecondaryButtons
                }
            ]

            //Error de compatibilitat amb els botons. No els deixa seleccionar
            // language: {
            //     url: "//cdn.datatables.net/plug-ins/1.10.19/i18n/Catalan.json"
            // }
        });
    }

    //Order Buttons
    function loadButtons(table){
        new $.fn.dataTable.Buttons( table, {
            buttons: [
                {
                    text: 'Delete Row',
                    action: function (e, dt, node, config) {
                        dt.rows({selected: true}).remove().draw();
                    },
                    className: 'btn-primary',
                    init: removeSecondaryButtons
                },
                {
                    text: 'Borrar tots els botons',
                    action: function (e, dt, node, config) {
                        dt.buttons().remove();
                    },
                    className: 'btn-primary',
                    init: removeSecondaryButtons
                }
            ]
        });

        table.buttons( 1, null ).container().appendTo("#buttonsZone");
    }

    //Color Cells
    function checkEdat(t){
        t.on( 'draw', function () {
            t.rows().every( function ( rowIdx, tableLoop, rowLoop ) {
                var data = this.data();
                var row = $(this.node());
                if(data['Edat']<18){
                    row.find('td:eq(2)').css('background-color', '#F6A5A5');
                }
                else if(data['Edat']>64){
                    row.find('td:eq(2)').css('background-color', '#F6F0A5');
                }
                else {
                    row.find('td:eq(2)').css('background-color', '#A9FEB4');
                }
            } );
        } );
    }
    function checkExperiencia(t){
        t.on( 'draw', function () {
            t.rows().every( function ( rowIdx, tableLoop, rowLoop ) {
                var data = this.data();
                var row = $(this.node());
                if(data['Experiencia']<6){
                    row.find('td:eq(3)').css('background-color', '#F6F0A5');
                }
            } );
        } );
    }

    //Dropdown Hide
    function filterSexe(t, sexe) {
        t.rows().every( function ( rowIdx, tableLoop, rowLoop ) {
            var data = this.data();
            var row = $(this.node());
            row.hide();
            if(data['Sexe'] !== sexe){
                row.show();
            }
        } );
    }

    //Hide column with checkboxes
    function hideColumn(t, col){
        var column = t.column(col);
        column.visible(!column.visible());
    }

    function removeSecondaryButtons(api, node, config){
        $(node).removeClass('btn-secondary');
    }

</script>
</body>
</html>